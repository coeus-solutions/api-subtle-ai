# Product Requirements Document (PRD)
**Backend for Video Analysis and Subtitle Generator Tool**

## Product Overview
This backend system processes videos uploaded by users, analyzes them using AI, and generates subtitle files. It leverages FastAPI for a robust and scalable API architecture, JWT for secure user authentication, Supabase for database management, and OpenAI for generating subtitles.

## Functional Requirements

### 1. User Authentication and Authorization
- **JWT Token Authentication:**
  - Secure user login and session management
  - Refresh tokens to ensure a smooth user experience
- **Register User:** Endpoint to register a new user
- **Login User:** Endpoint to authenticate users and issue JWT tokens
- **Protected Endpoints:** Ensure only authenticated users can access certain API routes

### 2. Video Upload and Management
- **Video Upload API:**
  - Accepts video files from authenticated users
  - Supports common video formats (MP4, AVI, MOV)
  - Ensures uploaded videos are stored securely (e.g., Supabase storage or external cloud storage)
- **List Uploaded Videos API:**
  - Fetches a list of videos uploaded by the user
  - Includes metadata such as video name, upload date, and status
- **Delete Video API:**
  - Allows users to delete previously uploaded videos

### 3. Subtitle Generation
- **Generate Subtitles API:**
  - Integrates with OpenAI's API to analyze uploaded videos and generate subtitles
  - Returns status updates during processing (e.g., "queued", "in-progress", "completed")
  - Endpoint: **POST /api/v1/videos/{video_uuid}/generate_subtitles**
- **Download Subtitle API:**
  - Provides downloadable `.srt` or `.vtt` files for completed subtitles
  - Endpoint: **GET /api/v1/subtitles/{subtitle_uuid}**

### 4. User History and Logs
- **Retrieve Generated Subtitles API:**
  - Lists all subtitles generated by the user
  - Links each entry to the associated video and provides download options
- **Activity Log API:**
  - Logs user actions (e.g., video uploads, subtitle downloads)

## Non-Functional Requirements

### 1. Performance
- Ensure fast video upload and subtitle generation
- Handle simultaneous processing requests efficiently

### 2. Security
- JWT-based authentication for secure API access
- Input validation to prevent injection attacks
- Encrypted storage for sensitive data and files

### 3. Scalability
- Support high traffic and concurrent processing using containerization (e.g., Docker)
- Utilize scalable cloud resources for video storage and AI processing

### 4. Availability
- Ensure 99.9% uptime for the API
- Implement automated health checks and recovery mechanisms

### 5. Logging and Monitoring
- Log all API requests and responses for debugging and analytics
- Use tools like Prometheus and Grafana for real-time monitoring

## API Endpoints

### 1. Authentication APIs
- **POST /api/v1/auth/register:** Register a new user
- **POST /api/v1/auth/login:** Authenticate a user and return JWT tokens

### 2. Video Management APIs
- **POST /api/v1/videos:** Upload a new video
- **GET /api/v1/videos:** List all uploaded videos
- **DELETE /api/v1/videos/{video_uuid}:** Delete an uploaded video

### 3. Subtitle Generation APIs
- **POST /api/v1/videos/{video_uuid}/generate_subtitles:** Start subtitle generation for a video
- **GET /api/v1/subtitles/{subtitle_uuid}:** Download the generated subtitle file

### 4. Logs and History APIs
- **GET /api/v1/logs:** Retrieve the activity log for the user
- **GET /api/v1/subtitles:** List all subtitles generated by the user

## Technical Specifications

### 1. Framework
- FastAPI for API development

### 2. Database
- Supabase for relational database and storage needs
- **Database Schema:**
  
  1. **Users Table**
     - `id`: Primary key (auto-incremented unsigned int)
     - `uuid`: Unique identifier (auto-generated UUID)
     - `email`: User email (unique, indexed)
     - `password_hash`: Encrypted password
     - `created_at`: Timestamp for record creation
     - `updated_at`: Timestamp for record updates

  2. **Videos Table**
     - `id`: Primary key (auto-incremented unsigned int)
     - `uuid`: Unique identifier (auto-generated UUID)
     - `user_id`: Foreign key (unsigned int) referencing `Users.id`
     - `video_url`: Path to the stored video file
     - `status`: Processing status (e.g., "queued", "completed")
     - `created_at`: Timestamp for record creation
     - `updated_at`: Timestamp for record updates

  3. **Subtitles Table**
     - `id`: Primary key (auto-incremented unsigned int)
     - `uuid`: Unique identifier (auto-generated UUID)
     - `video_id`: Foreign key (unsigned int) referencing `Videos.id`
     - `subtitle_url`: Path to the generated subtitle file
     - `format`: Subtitle format (e.g., "srt", "vtt")
     - `created_at`: Timestamp for record creation
     - `updated_at`: Timestamp for record updates

  4. **Logs Table**
     - `id`: Primary key (auto-incremented unsigned int)
     - `uuid`: Unique identifier (auto-generated UUID)
     - `user_id`: Foreign key (unsigned int) referencing `Users.id`
     - `action`: Description of the logged action
     - `created_at`: Timestamp for record creation

### 3. AI/ML Models
- OpenAI Whisper API or similar for video-to-text subtitle generation

### 4. Storage
- Use Supabase storage or external cloud storage (e.g., AWS S3) for storing uploaded videos and generated subtitles

